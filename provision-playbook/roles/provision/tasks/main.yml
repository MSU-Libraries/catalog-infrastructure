---
- name: Create AWS config directory
  file:
    path: "/root/.aws"
    state: directory

- name: Create AWS credential file
  copy:
    dest: "/root/.aws/credentials"
    content: "{{ aws_credential_template }}"

- name: Provision catalog server cluster
  community.general.terraform:
    project_path: "../terraform/env/prod/"
    state: present
    provider_upgrade: yes
    # focing init because state file exists in s3 and need provider
    # installed locally before we can detect it
    force_init: yes 
  register: tf

- name: Save outputs to host file
  copy:
    dest: "../configure-playbook/hosts"
    content: |
      {{ catalog_a_public_ip }}
      {{ catalog_b_public_ip }}
      {{ catalog_c_public_ip }}

- name: Call configure playbook
